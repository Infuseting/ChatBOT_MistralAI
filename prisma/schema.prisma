generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum Sender {
  user
  assistant
}

enum AttributeType{
  file
  image
  video
  audio
}

enum AuthProvider {
  GOOGLE
  MDP
  OTHER
}

model User {
  id        String   @id @default(uuid())
  name      String   @db.LongText
  password  String?  @db.LongText
  email     String?  @unique
  googleId  String?  @unique
  provider  AuthProvider @default(OTHER)
  avatar    String?  @db.LongText
  createdAt DateTime @default(now())

  threads      Thread[]
  accessTokens AccessToken[]
  shares       Share[]
}

model Thread {
  id        String    @id @default(uuid())
  idThread  String    @unique
  name      String   @db.LongText
  context   String?  @db.LongText
  model     String?  @db.LongText
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  user      User      @relation(fields: [userId], references: [id])
  userId    String
  messages  Message[]
  shares    Share[]
}

model Message {
  id        String   @id @default(uuid())
  idMessage String   @unique
  thinking  String   @db.LongText
  text      String   @db.LongText
  sender    Sender
  sentAt    DateTime @default(now())

  parentId String? @db.LongText

  thread   Thread @relation(fields: [idThread], references: [idThread])
  idThread String
  attachments Attachment[]
}

model AccessToken {
  id        String    @id @default(uuid())
  token     String    @unique
  user      User      @relation(fields: [userId], references: [id])
  userId    String
  createdAt DateTime  @default(now())
  expiresAt DateTime?
}

model Share {
  id        String    @id @default(uuid())
  code      String    @unique
  thread    Thread?   @relation(fields: [idThread], references: [id])
  idThread  String?
  user      User?     @relation(fields: [userId], references: [id])
  userId    String?
  createdAt DateTime  @default(now())
  expiresAt DateTime?
  clicks    Int       @default(0)
}

model Attachment {
  id String @id @default(uuid())
  fileName String
  extension String
  type AttributeType
  libraryId String 
  message   Message  @relation(fields: [messageId], references: [id])
  messageId String
  data   Data @relation(fields: [sha256], references: [sha256])
  sha256 String @db.VarChar(256)
}

model Data {
  sha256 String @id @db.VarChar(256)
  data String @db.LongText 
  attachments Attachment[]
}